<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Đăng ký học | Trung tâm Khai Minh</title>
    <link rel="stylesheet" href="style.css" />
    <style>
    body {
      background: #fffaf4;
      font-family: Arial, sans-serif;
    }

    .register-section {
      max-width: 600px;
      margin: 80px auto;
      background: #fff;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }

    .register-section h2 {
      text-align: center;
      color: #f57c00;
      margin-bottom: 25px;
    }

    .register-section label {
      display: block;
      margin-top: 15px;
      font-weight: 600;
    }

    .register-section input,
    .register-section select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ddd;
      border-radius: 6px;
    }

    .register-section button {
      margin-top: 25px;
      background: #f57c00;
      color: #fff;
      border: none;
      padding: 12px 20px;
      width: 100%;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }

    .register-section button:hover {
      background: #e56f00;
    }

    .qr-section {
      text-align: center;
      margin-top: 35px;
      display: none;
      animation: fadeIn 0.8s ease;
    }

    .qr-section img {
      max-width: 250px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    header {
      background: #fff;
      padding: 20px 40px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header .logo {
      display: flex;
      align-items: center;
      font-weight: bold;
    }

    header .logo div {
      width: 50px;
      height: 50px;
      /* background: #fff5e6; */
      /* border: 2px dashed #f57c00; */
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 10px;
      color: #999;
    }

    header a {
      text-decoration: none;
      color: #333;
      font-weight: 500;
    }

    .course-info-box {
      margin-top: 15px;
      padding: 15px;
      background: #fffaf2;
      border: 1px solid #fcd4a3;
      border-radius: 8px;
      line-height: 1.5;
      animation: fadeIn 0.5s ease;
    }

    .course-info-box h4 {
      color: #f57c00;
      margin-bottom: 8px;
    }
  </style>
  </head>
  <body>

    <header>
      <div class="logo">
        <div><img src="./logoIconKhaMinh.png" alt="logo"
            style="width: 100px;"></div>
        <!-- Trung tâm Khai Minh -->
      </div>
      <nav>
        <a href="index.html">← Quay lại trang chủ</a>
      </nav>
    </header>

    <section class="register-section">
      <h2>Đăng ký khóa học</h2>

      <form id="registerForm">
        <label>Họ và tên</label>
        <input type="text" id="name" required>

        <label>Số điện thoại</label>
        <input type="tel" id="phone" required>

        <label>Email</label>
        <input type="email" id="email" required>

        <label>Khóa học</label>
        <input type="text" id="courseName" readonly style="background:#fffaf4;">

        <label>Lứa tuổi</label>
        <input type="text" id="age" readonly style="background:#fffaf4;">

        <label>Lịch học</label>
        <input type="text" id="schedule" readonly style="background:#fffaf4;">

        <label>Học phí</label>
        <input type="text" id="fee" readonly style="background:#fffaf4;">

        <label>Chọn gói học</label>
        <select id="package" required>
          <option value>-- Chọn gói học --</option>
          <option value="Gói tháng">Gói tháng</option>
          <option value="Gói 3 tháng">Gói 3 tháng</option>
        </select>

        <button type="submit">Đăng ký ngay</button>
      </form>

      <div class="qr-section" id="qrSection">
        <h3>Cảm ơn bạn đã đăng ký!<br>Vui lòng quét mã QR bên dưới để thanh
          toán.</h3>
        <img src="QRTTKM.jpg" alt="QR Thanh toán">
        <p style="margin-top:15px;">Sau khi thanh toán, trung tâm sẽ liên hệ xác
          nhận lịch học.</p>
      </div>
    </section>

    <script>
document.addEventListener('DOMContentLoaded', () => {
  const params = new URLSearchParams(window.location.search);
  const courseKey = params.get('course');
  const age = params.get('age');
  const schedule = params.get('schedule');
  const fee = params.get('fee');

  const mapCourseName = {
    toan: "Toán tư duy",
    kynang: "Kỹ năng sống",
    hohoa: "Hội họa",
    amnhac: "Âm nhạc" 
  };
  
  function normalize(str = "") {
    return str
      .toString()
      .normalize('NFD')
      .replace(/[\u0300-\u036f]/g, '') // remove diacritics
      .replace(/\s+/g, ' ')
      .trim()
      .toLowerCase();
  }

  // Gán dữ liệu vào form
 // Nếu truyền là key (toan/kynang/hohoa/amnhac) thì đổi sang tên đầy đủ
// Nếu truyền là tên tiếng Việt, thì giữ nguyên
document.getElementById('courseName').value =
  mapCourseName[courseKey] || decodeURIComponent(courseKey) || '';

  document.getElementById('age').value = age || '';
  document.getElementById('schedule').value = schedule || '';
  document.getElementById('fee').value = fee || '';

  const form = document.getElementById('registerForm');
  const qrSection = document.getElementById('qrSection');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const data = {
      name: document.getElementById('name').value,
      phone: document.getElementById('phone').value,
      email: document.getElementById('email').value,
      course: document.getElementById('courseName').value,
      age: document.getElementById('age').value,
      schedule: document.getElementById('schedule').value,
      fee: document.getElementById('fee').value,
      package: document.getElementById('package').value
    };

    const scriptURL = "https://script.google.com/macros/s/AKfycbw7NLQpU4T6hXkoCkCxB__ecJUzj9Gk4mTbovJrrlPslySVVzw2YtPICfwGKbIR-MbP/exec";

    try {
      await fetch(scriptURL, {
        method: "POST",
        mode: "no-cors",
       headers: { "Content-Type": "application/x-www-form-urlencoded" },
  body: new URLSearchParams(
    Object.entries(data).map(([k, v]) => [k, encodeURIComponent(v)])
  ).toString()
      });

      form.style.display = "none";
      qrSection.style.display = "block";
      qrSection.scrollIntoView({ behavior: "smooth" });
    } catch (err) {
      alert("❌ Gửi dữ liệu thất bại, vui lòng thử lại!");
      console.error(err);
    }
  });
});
</script>

  </body>
</html>
